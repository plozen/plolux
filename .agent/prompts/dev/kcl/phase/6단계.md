# [Step 6: 최종 점검 및 프로덕션 최적화]

## 1. 목표

모든 기능 구현을 완료한 프로젝트를 **실제 서비스 가능한 제품**으로 만듭니다.
**환경 변수 기반의 동적 설정**을 통해 **Real 서비스(Cloudflare)**와 **Test 환경(GitHub Pages)** 모두에서 완벽하게 동작하는 SEO 및 PWA 시스템을 구축합니다.

---

## 2. 구현 요구사항

### [Task 1] 환경 변수 기반 상수 관리

**파일**: `packages/kcl/src/lib/constants.ts` (신규 생성 권장)

```typescript
export const SITE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000';
export const BASE_PATH = process.env.NEXT_PUBLIC_BASE_PATH || '';
export const FULL_URL = `${SITE_URL}${BASE_PATH}`;
```

### [Task 2] SEO 및 메타데이터 최적화

**파일**: `packages/kcl/src/app/layout.tsx`

```typescript
import { Metadata } from 'next';
import { FULL_URL } from '@/lib/constants';

export const metadata: Metadata = {
  metadataBase: new URL(FULL_URL),
  title: {
    template: '%s | KCL',
    default: 'KCL - Kpop Company League',
  },
  description: "Prove your fandom's firepower...",
  openGraph: {
    // ...
    url: FULL_URL,
  },
  // ...
};
```

---

### [Task 3] PWA 설정 (Dynamic Manifest)

정적 `manifest.json` 대신 `manifest.ts`를 사용하여 환경에 따라 경로를 동적으로 생성합니다.

**파일**: `packages/kcl/src/app/manifest.ts`

```typescript
import { MetadataRoute } from 'next';
import { BASE_PATH } from '@/lib/constants';

export default function manifest(): MetadataRoute.Manifest {
  return {
    name: 'Kpop Company League',
    short_name: 'KCL',
    start_url: `${BASE_PATH}/`,
    scope: `${BASE_PATH}/`,
    display: 'standalone',
    theme_color: '#8B5CF6',
    background_color: '#0a0a0a',
    icons: [
      {
        src: `${BASE_PATH}/icon-192.png`,
        sizes: '192x192',
        type: 'image/png',
      },
      {
        src: `${BASE_PATH}/icon-512.png`,
        sizes: '512x512',
        type: 'image/png',
      },
    ],
  };
}
```

---

### [Task 4] Search Engine Configuration (Dynamic)

**파일 1**: `packages/kcl/src/app/robots.ts`

```typescript
import { MetadataRoute } from 'next';
import { FULL_URL } from '@/lib/constants';

export default function robots(): MetadataRoute.Robots {
  return {
    rules: {
      userAgent: '*',
      allow: '/',
      disallow: ['/_next/'],
    },
    sitemap: `${FULL_URL}/sitemap.xml`,
  };
}
```

**파일 2**: `packages/kcl/src/app/sitemap.ts`

```typescript
import { MetadataRoute } from 'next';
import { FULL_URL } from '@/lib/constants';

export default function sitemap(): MetadataRoute.Sitemap {
  return [
    {
      url: FULL_URL,
      lastModified: new Date(),
      // ...
    },
    {
      url: `${FULL_URL}/en/ranking`,
      // ...
    },
    // ...
  ];
}
```

---

### [Task 5] 커스텀 404 페이지

**파일**: `packages/kcl/src/app/not-found.tsx`
(기존 계획과 동일하게 유지하되, 홈으로 돌아가는 링크에 `BASE_PATH` 고려 필요 없음 - Next.js Link가 자동 처리)

---

## 3. 디자인 스펙 (유지)

| 항목       | 설정                                |
| ---------- | ----------------------------------- |
| 404 텍스트 | Glitch 효과 (좌우 진동)             |
| Spotlight  | Radial Gradient + Blur (50% 투명도) |
| 배경       | Dark Gradient (0a0a0a → 1a1a2e)     |
| 버튼       | Primary Gradient + Glow 효과        |
| 애니메이션 | Spring (초기 진입 시 0.8초)         |

---

## 4. 파일 생성 체크리스트

- [ ] `packages/kcl/src/lib/constants.ts` ✨ NEW
- [ ] `packages/kcl/src/app/layout.tsx` (수정)
- [ ] `packages/kcl/src/app/manifest.ts` ✨ NEW (json 대신 ts)
- [ ] `packages/kcl/src/app/robots.ts` ✨ NEW
- [ ] `packages/kcl/src/app/sitemap.ts` ✨ NEW
- [ ] `packages/kcl/src/app/not-found.tsx` ✨ NEW
- [ ] `packages/kcl/src/app/not-found.module.scss` ✨ NEW

---

## 5. 마스터 프롬프트 (AI 실행용)

```markdown
# 1. 목표

`kcl` 프로젝트의 **Cloudflare(Real)** 및 **GitHub Pages(Test)** 멀티 환경 배포를 지원하기 위해, **환경 변수 기반의 동적 SEO/PWA 설정**을 구현합니다.

**핵심 전략**:

- 하드코딩된 URL을 제거하고 `process.env.NEXT_PUBLIC_SITE_URL`과 `process.env.NEXT_PUBLIC_BASE_PATH`를 조합하여 사용합니다.
- 정적 `manifest.json` 대신 `manifest.ts`를 사용해 PWA 경로를 동적으로 생성합니다.

---

# 2. 구현할 파일 목록

### 1. `src/lib/constants.ts`

- `SITE_URL`과 `BASE_PATH` 상수를 정의하여 중앙에서 관리합니다.

### 2. `src/app/layout.tsx`

- `metadataBase`를 설정하고, `constants.ts`를 import하여 메타데이터 URL을 구성합니다.

### 3. `src/app/manifest.ts`

- `start_url`, `icons.src` 등에 `BASE_PATH`를 접두어로 붙여 어떤 서브 디렉토리 환경에서도 아이콘을 찾을 수 있게 합니다.

### 4. `src/app/sitemap.ts` & `src/app/robots.ts`

- `FULL_URL`을 사용하여 정확한 절대 경로 Sitemap을 생성합니다.

### 5. `src/app/not-found.tsx` & `module.scss`

- "The Stage is Empty" 컨셉의 세련된 404 페이지를 구현합니다.

---

# 3. 결과물

위 5가지 항목에 대한 코드를 작성하여 적용해 주십시오.
```
