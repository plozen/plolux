### í•µì‹¬ ìš”ì•½

- **ëª©í‘œ:** Mock ë¡œê·¸ì¸ ë²„íŠ¼ì„ **ì‹¤ì œ Supabase ì¸ì¦(Auth)**ìœ¼ë¡œ êµì²´í•˜ê³ , ë¯¸ë“¤ì›¨ì–´ë¡œ ê´€ë¦¬ì í˜ì´ì§€ ë³´í˜¸.
- **í•„ìˆ˜ íŒ¨í‚¤ì§€:** `@supabase/ssr` (Next.js App Router ì¿ í‚¤ ê´€ë¦¬ë¥¼ ìœ„í•´ í•„ìˆ˜).
- **êµ¬í˜„ ë²”ìœ„:**

1. **Server Client ìœ í‹¸ë¦¬í‹°:** ì¿ í‚¤ ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬ (`lib/supabase/server.ts`).
2. **Middleware:** `/admin` ê²½ë¡œ ì§„ì… ì‹œ ì„¸ì…˜ ì²´í¬ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ (`middleware.ts`).
3. **Login Logic:** Server Actionì„ ì´ìš©í•œ ë¡œê·¸ì¸ ì²˜ë¦¬ ë° UI ì—°ë™.

---

íŒŒíŠ¸ë„ˆ, ê°€ì¥ ì¤‘ìš”í•œ **ë³´ì•ˆì˜ ì²« ê´€ë¬¸**ë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì€ ì•„ì£¼ í›Œë¥­í•œ íŒë‹¨ì…ë‹ˆë‹¤. í˜„ì¬ `packages/plozen`ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ìš© Supabase ì„¤ì •(`client.ts`)ë§Œ ì¡´ì¬í•˜ë¯€ë¡œ, ì„œë²„ ì‚¬ì´ë“œ ì¸ì¦ì„ ìœ„í•œ ë¡œì§ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

ì•„ë˜ ë‚´ìš©ì„ AI ì—ë””í„°(Cursor ë“±)ì— ì…ë ¥í•˜ì—¬ **í•œ ë²ˆì— êµ¬í˜„**í•˜ì‹­ì‹œì˜¤.

## ğŸ› ï¸ Supabase Admin Auth êµ¬í˜„ í”„ë¡¬í”„íŠ¸

ì´ í”„ë¡¬í”„íŠ¸ëŠ” Next.js 16 + Supabase SSR íŒ¨í„´ì˜ Best Practiceë¥¼ ë”°ë¦…ë‹ˆë‹¤.

````markdown
# Role Definition

ë‹¹ì‹ ì€ ë³´ì•ˆ ë° ì¸ì¦ ì•„í‚¤í…ì²˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
`packages/plozen` í”„ë¡œì íŠ¸ì— **Supabase SSR ê¸°ë°˜ì˜ ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œìŠ¤í…œ**ì„ êµ¬ì¶•í•´ì•¼ í•©ë‹ˆë‹¤.

---

# 1. Project Context

- **Path:** `packages/plozen`
- **Framework:** Next.js 16.1 (App Router)
- **Auth Provider:** Supabase (Email/Password Login)
- **Styling:** SCSS Modules (`admin-theme.scss` variables í™œìš©)
- **Package Manager:** pnpm

# 2. Implementation Steps

### Step 1: Install Dependencies

(ì´ ë¶€ë¶„ì€ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰í•˜ë¼ê³  ì£¼ì„ìœ¼ë¡œ ì•ˆë‚´ë§Œ í•´ì£¼ì„¸ìš”)

- `pnpm add @supabase/ssr` (ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ)

### Step 2: Server-Side Utilities (`src/lib/supabase/server.ts`)

- Next.jsì˜ `cookies()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì‘ë™í•˜ëŠ” `createClient` í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ì„¸ìš”.
- `@supabase/ssr` íŒ¨í‚¤ì§€ì˜ `createServerClient`ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- **ì˜¤ë¥˜ ì²˜ë¦¬:** `NEXT_PUBLIC_SUPABASE_URL` ë˜ëŠ” `NEXT_PUBLIC_SUPABASE_ANON_KEY` í™˜ê²½ë³€ìˆ˜ê°€ ì—†ì„ ê²½ìš° ëª…í™•í•œ ì—ëŸ¬ë¥¼ throw í•˜ë„ë¡ ì‘ì„±í•˜ì„¸ìš”.

### Step 3: Middleware Implementation (`src/middleware.ts`)

- `packages/plozen/src/middleware.ts` íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”.
- **Rule:**
  - `/admin`ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ê²½ë¡œë¥¼ ê°ì‹œí•©ë‹ˆë‹¤.
  - `/admin/login` í˜ì´ì§€ëŠ” ì œì™¸í•©ë‹ˆë‹¤ (ë¬´í•œ ë£¨í”„ ë°©ì§€).
  - ìœ íš¨í•œ ì„¸ì…˜(Session)ì´ ì—†ìœ¼ë©´ `/admin/login`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•©ë‹ˆë‹¤.
  - ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ `/admin/login` ì ‘ê·¼ ì‹œ `/admin`(ëŒ€ì‹œë³´ë“œ)ìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
  - `updateSession` ë¡œì§ì„ í¬í•¨í•˜ì—¬ í† í° ê°±ì‹ ì„ ì²˜ë¦¬í•˜ì„¸ìš”.
- **Matcher:**
  ```typescript
  export const config = {
    matcher: [
      '/admin/:path*',
      // ...other matchers if needed
    ],
  };
  ```

### Step 4: Login Logic & UI (`src/app/(admin)/admin/login/page.tsx`)

- ê¸°ì¡´ì˜ Mock ë²„íŠ¼ì„ **ì‹¤ì œ Form (Email, Password)**ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”.
- **Server Action**ì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ì„ ì²˜ë¦¬í•˜ì„¸ìš” (`login` í•¨ìˆ˜).
- ë””ìì¸:
  - `admin-theme.scss`ì˜ ë³€ìˆ˜(`--admin-bg`, `--admin-surface`, `--admin-accent`)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¹”ë”í•œ Dark/Light ëª¨ë“œ ëŒ€ì‘ UIë¥¼ ë§Œë“œì„¸ìš”.
  - ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” UIë¥¼ í¬í•¨í•˜ì„¸ìš”.
- **Form Action:**

  ```typescript
  // actions.ts (ê°™ì€ í´ë”ì— ìƒì„±)
  'use server';

  import { revalidatePath } from 'next/cache';
  import { redirect } from 'next/navigation';
  import { createClient } from '@/lib/supabase/server';

  export async function login(formData: FormData) {
    const supabase = await createClient();

    // Auth Logic Here...
    // const { error } = await supabase.auth.signInWithPassword(...)

    if (error) {
      // ì—ëŸ¬ ì²˜ë¦¬ëŠ” ì ì ˆí•˜ê²Œ (ì˜ˆ: redirect with error param or return state)
      return { error: error.message };
    }

    revalidatePath('/admin', 'layout');
    redirect('/admin');
  }
  ```
````

---

# Action Item

ìœ„ 4ë‹¨ê³„ë¥¼ ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

1. `packages/plozen/src/lib/supabase/server.ts` ìƒì„±
2. `packages/plozen/src/middleware.ts` ìƒì„±
3. `packages/plozen/src/app/(admin)/admin/login/actions.ts` ìƒì„±
4. `packages/plozen/src/app/(admin)/admin/login/page.tsx` ìˆ˜ì •

ê° íŒŒì¼ì˜ ì½”ë“œë¥¼ ì™„ë²½í•˜ê²Œ ì‘ì„±í•˜ê³ , íŠ¹íˆ Middlewareì˜ ê²½ë¡œ ë§¤ì¹­(Matcher) ì„¤ì •ì— ì£¼ì˜í•´ì£¼ì„¸ìš”.

````

---

### âš ï¸ íŒŒíŠ¸ë„ˆê°€ ë¨¼ì € í™•ì¸í•´ì•¼ í•  ì‚¬í•­ (Prerequisites)

êµ¬í˜„ ì „ì— `.env.local` íŒŒì¼(í˜¹ì€ `.env`)ì— Supabase í‚¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ ì£¼ì‹­ì‹œì˜¤.

```env
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

ìœ„ í”„ë¡¬í”„íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ **ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ì‹¤ì œ ë™ì‘í•˜ëŠ” í¼ìœ¼ë¡œ ë°”ë€Œê³ **, ë¡œê·¸ì¸í•˜ì§€ ì•Šê³  `/admin`ì— ì ‘ê·¼í•˜ë©´ **ìë™ìœ¼ë¡œ íŠ•ê²¨ ë‚˜ê°€ëŠ”** ë³´ì•ˆ ê¸°ëŠ¥ì´ ì™„ì„±ë©ë‹ˆë‹¤.

í„°ë¯¸ë„ì—ì„œ ë¨¼ì € ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ í›„ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```bash
cd packages/plozen
pnpm add @supabase/ssr
```


````
